---
// Security Settings Component for Settings Panel - Material Design Style
---

<!-- Data Encryption -->
<div class="setting-group">
  <h4 class="setting-title">Data Encryption</h4>
  <div class="material-switch">
    <input type="checkbox" id="encryption-enabled" />
    <div class="switch-track">
      <div class="switch-thumb"></div>
    </div>
    <label for="encryption-enabled" class="switch-label">Enable local data encryption</label>
  </div>
  <p class="setting-description">Encrypt your chat history and settings stored locally in this browser (localStorage/IndexedDB) with a password — AES-256-GCM • PBKDF2 • Client-side only</p>
</div>


<!-- Password Management -->
<div class="setting-group">
  <h4 class="setting-title">Password Management</h4>
  <div style="display: flex; gap: 0.75rem; flex-wrap: wrap;">
    <button id="set-password-btn" class="btn-outlined">
      <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <rect x="6" y="11" width="12" height="9" rx="2" ry="2" stroke-width="2"/>
        <path d="M10 11V7a2 2 0 0 1 4 0" stroke-width="2" stroke-linecap="round"/>
      </svg>
      Set Password
    </button>
    <button id="change-password-btn" class="btn-outlined" style="display: none;">
      <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"/>
      </svg>
      Change Password
    </button>
    <button id="test-unlock-btn" class="btn-outlined" style="display: none;">
      <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <rect x="6" y="11" width="12" height="9" rx="2" ry="2" stroke-width="2"/>
        <path d="M10 11V7a2 2 0 0 1 4 0" stroke-width="2" stroke-linecap="round"/>
      </svg>
      Test Unlock
    </button>
  </div>
  <p class="setting-description">Manage your encryption password and test access</p>
</div>

<!-- Security Details merged into description above -->

<!-- Auto-Lock Timer -->
<div class="setting-group">
  <h4 class="setting-title">Auto-Lock Timer</h4>
  <div class="custom-select-wrapper">
    <select id="auto-lock-select" class="custom-select">
      <option value="0">Never</option>
      <option value="5">5 minutes</option>
      <option value="15">15 minutes</option>
      <option value="30" selected>30 minutes</option>
      <option value="60">1 hour</option>
      <option value="120">2 hours</option>
    </select>
    <svg class="select-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
    </svg>
  </div>
  <p class="setting-description">Automatically lock encrypted data after inactivity</p>
</div>

<!-- Password Setup Modal -->
<div id="password-setup-modal" class="confirm-modal hidden">
  <div class="confirm-modal-backdrop"></div>
  <div class="confirm-modal-container">
    <div class="confirm-modal-content password-setup-content">
      <div class="confirm-modal-header">
        <div class="confirm-modal-icon password-setup-icon">
          <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
          </svg>
        </div>
        <div class="confirm-modal-text">
          <h3 class="confirm-modal-title">Set Encryption Password</h3>
          <p class="confirm-modal-message">Create a secure password to encrypt your data</p>
        </div>
      </div>
      
      <div class="confirm-modal-body">
        <div class="password-form">
          <div class="form-field" id="current-password-field" style="display:none;">
            <label for="current-password" class="form-label">Current Password</label>
            <input type="password" id="current-password" class="form-input" placeholder="Enter current password" />
          </div>
          <div class="form-field">
            <label for="new-password" class="form-label">Password</label>
            <input type="password" id="new-password" class="form-input" placeholder="Enter your password" />
          </div>
          <div class="form-field">
            <label for="confirm-password" class="form-label">Confirm Password</label>
            <input type="password" id="confirm-password" class="form-input" placeholder="Confirm your password" />
          </div>
        </div>
      </div>
      
      <div class="confirm-modal-actions">
        <button class="confirm-btn confirm-btn-secondary" onclick="closePasswordModal()">Cancel</button>
        <button id="password-submit-button" class="confirm-btn confirm-btn-primary" onclick="savePassword()">
          <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <rect x="6" y="11" width="12" height="9" rx="2" ry="2" stroke-width="2"/>
            <path d="M10 11V7a2 2 0 0 1 4 0" stroke-width="2" stroke-linecap="round"/>
          </svg>
          <span id="password-submit-label">Set Password</span>
        </button>
      </div>
    </div>
  </div>
</div>

<style>
/* Password Setup Modal Styles */
.password-setup-content {
  width: 100%;
  max-width: 420px;
}

.password-setup-icon {
  background: rgba(var(--md-primary), 0.1);
  border-color: rgba(var(--md-primary), 0.2);
  color: rgb(var(--md-primary));
}

.password-form {
  width: 100%;
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.form-field {
  margin-bottom: 0;
}

/* Dark theme adjustments */
[data-theme="dark"] .password-setup-content,
[data-theme$="-dark"] .password-setup-content {
  background: rgba(var(--md-surface), 0.9);
  border: 1px solid rgba(var(--md-outline-variant), 0.4);
}
</style>

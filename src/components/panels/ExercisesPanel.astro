---
import ViewToggle from '../ViewToggle.astro';
import RelaxationModal from '../RelaxationModal.astro';
---

<div id="panel-exercises" class="flex-1 flex flex-col hidden app-panel">
  <div class="p-6 max-w-4xl mx-auto w-full">
    <!-- Panel Header -->
    <div class="panel-section-header">
      <div class="header-left-section">
        <div class="section-title">
          <svg class="w-6 h-6 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
          </svg>
          Mindfulness Studio
        </div>
        <div class="section-count-island">
          <span class="section-count" id="exercises-count">8</span>
        </div>
      </div>
      <ViewToggle panelId="panel-exercises" />
    </div>
    
    <!-- Exercise Entries -->
    <div class="journal-entries-container" id="exercises-container" data-view-container>
      <!-- Progress Summary Card -->
      <div class="journal-entry-card-enhanced progress-stats-card">
        <div class="progress-stats-header">
          <div class="progress-stats-icon">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
            </svg>
          </div>
          <div class="progress-stats-title">
            <h3 class="progress-title">Mindfulness Progress</h3>
            <p class="progress-subtitle">Track your meditation journey</p>
          </div>
        </div>
        <div class="progress-stats-grid">
          <div class="progress-stat-item">
            <div class="stat-value" id="total-sessions">0</div>
            <div class="stat-label">Sessions</div>
            <div class="stat-indicator sessions"></div>
          </div>
          <div class="progress-stat-item">
            <div class="stat-value" id="total-minutes">0</div>
            <div class="stat-label">Minutes</div>
            <div class="stat-indicator minutes"></div>
          </div>
          <div class="progress-stat-item">
            <div class="stat-value" id="streak-days">0</div>
            <div class="stat-label">Day Streak</div>
            <div class="stat-indicator streak"></div>
          </div>
        </div>
      </div>

      <!-- Breathing Exercises -->
      <div class="journal-entry-card-enhanced exercise-card" data-exercise="4-7-8">
        <div class="journal-entry-header">
          <div class="journal-entry-date-bg">
            <div class="journal-date-day">4-7-8</div>
            <div class="journal-date-month">Breathing</div>
          </div>
          <div class="journal-entry-meta">
            <h4 class="journal-entry-title">4-7-8 Breathing</h4>
            <div class="journal-entry-info">
              <span class="journal-entry-time">5 min</span>
              <span class="exercise-difficulty">Beginner</span>
            </div>
          </div>
        </div>
        <div class="journal-entry-content">
          A powerful technique to activate your parasympathetic nervous system. Inhale for 4, hold for 7, exhale for 8 counts. Perfect for reducing anxiety and promoting relaxation.
          <div class="mt-4">
            <button class="meditation-start-btn" data-exercise="4-7-8">
              <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-6 4h.01M15 14h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
              </svg>
              Start Session
            </button>
          </div>
        </div>
      </div>

      <div class="journal-entry-card-enhanced exercise-card" data-exercise="box">
        <div class="journal-entry-header">
          <div class="journal-entry-date-bg">
            <div class="journal-date-day">Box</div>
            <div class="journal-date-month">Breathing</div>
          </div>
          <div class="journal-entry-meta">
            <h4 class="journal-entry-title">Box Breathing</h4>
            <div class="journal-entry-info">
              <span class="journal-entry-time">3 min</span>
              <span class="exercise-difficulty">Intermediate</span>
            </div>
          </div>
        </div>
        <div class="journal-entry-content">
          Equal counts for inhale, hold, exhale, and hold. Perfect for building concentration and reducing stress. Used by military and first responders.
          <div class="mt-4">
            <button class="meditation-start-btn" data-exercise="box">
              <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-6 4h.01M15 14h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
              </svg>
              Start Session
            </button>
          </div>
        </div>
      </div>

      <div class="journal-entry-card-enhanced exercise-card" data-exercise="5-4-3-2-1">
        <div class="journal-entry-header">
          <div class="journal-entry-date-bg">
            <div class="journal-date-day">5-4-3</div>
            <div class="journal-date-month">Grounding</div>
          </div>
          <div class="journal-entry-meta">
            <h4 class="journal-entry-title">5-4-3-2-1 Grounding</h4>
            <div class="journal-entry-info">
              <span class="journal-entry-time">3 min</span>
              <span class="exercise-difficulty">Anxiety Relief</span>
            </div>
          </div>
        </div>
        <div class="journal-entry-content">
          Sensory grounding technique for anxiety relief. Notice 5 things you see, 4 you touch, 3 you hear, 2 you smell, 1 you taste. Anchor yourself in the present moment.
          <div class="mt-4">
            <button class="meditation-start-btn" data-exercise="5-4-3-2-1">
              <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-6 4h.01M15 14h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
              </svg>
              Start Session
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Include the new Relaxation Modal -->
<RelaxationModal />

<script is:inline>
// @ts-nocheck
// Enhanced Exercise Panel with Relaxation Modal Integration
class ExercisePanel {
  constructor() {
    this.initializeEventListeners();
    this.loadProgress();
  }
  
  initializeEventListeners() {
    // Exercise start buttons - now opens the new relaxation modal
    document.querySelectorAll('.meditation-start-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const exerciseType = btn.getAttribute('data-exercise');
        if (window.openRelaxationModal) {
          window.openRelaxationModal(exerciseType);
        }
      });
    });
  }
  
  loadProgress() {
    const progress = JSON.parse(localStorage.getItem('meditationProgress') || '{"sessions": 0, "minutes": 0, "lastSession": null}');
    this.displayProgress(progress);
  }
  
  displayProgress(progress) {
    document.getElementById('total-sessions').textContent = progress.sessions;
    document.getElementById('total-minutes').textContent = progress.minutes;
    
    // Calculate streak
    const today = new Date().toISOString().split('T')[0];
    const lastSession = progress.lastSession;
    let streak = 0;
    
    if (lastSession === today) {
      streak = 1; // Simplified streak calculation
    }
    
    document.getElementById('streak-days').textContent = streak;
  }
}

// Global function for relaxation modal to update progress
window.updateExerciseProgress = function(progress) {
  const panel = new ExercisePanel();
  panel.displayProgress(progress);
};

// Initialize exercise panel when page loads
document.addEventListener('DOMContentLoaded', () => {
  new ExercisePanel();
});
</script>

class l{modal=null;form=null;isEditMode=!1;constructor(){this.init()}init(){if(typeof window<"u"&&window.__journalModalInit)return;typeof window<"u"&&(window.__journalModalInit=!0);const e=Array.from(document.querySelectorAll("#journal-modal"));e.length>1&&(e.slice(1).forEach(t=>{t.parentElement?.removeChild(t)}),console.warn("[JournalModal] Removed duplicate modal instances:",e.length-1)),this.modal=e[0]||document.getElementById("journal-modal"),this.form=document.getElementById("journal-entry-form"),!(!this.modal||!this.form)&&(this.modal.parentElement!==document.body&&document.body.appendChild(this.modal),this.modal.classList.add("journal-modal-portal"),this.bindEvents(),this.setupCharacterCounter())}bindEvents(){document.getElementById("new-journal-btn")?.addEventListener("click",()=>this.openModal()),document.addEventListener("click",o=>{const s=o.target;if(s.closest(".journal-edit-btn")){const r=s.closest(".journal-edit-btn")?.getAttribute("data-journal-id");r&&this.openModal(r)}if(s.closest(".memory-edit-btn")){const r=s.closest(".memory-edit-btn")?.getAttribute("data-memory-id");r&&this.openModalForMemory(r)}}),document.getElementById("journal-cancel")?.addEventListener("click",o=>{o.preventDefault(),o.stopPropagation(),o.stopImmediatePropagation(),this.closeModal()}),document.getElementById("journal-save")?.addEventListener("click",o=>{o.preventDefault(),this.saveEntry()}),document.getElementById("journal-save-draft")?.addEventListener("click",o=>{o.preventDefault(),this.saveDraft()}),this.modal?.querySelector(".confirm-modal-backdrop")?.addEventListener("click",o=>{o.preventDefault(),o.stopPropagation(),this.closeModal()}),document.addEventListener("keydown",o=>{o.key==="Escape"&&this.modal?.classList.contains("show")&&this.closeModal()})}setupCharacterCounter(){const e=document.getElementById("journal-content"),t=document.getElementById("journal-char-count");if(!e||!t)return;const n=()=>{const a=e.value.length;t.textContent=a.toString(),a>1800?t.style.color="rgb(var(--md-error))":a>1500?t.style.color="rgb(var(--md-warning))":t.style.color="rgb(var(--on-surface-variant))"};e.addEventListener("input",n),n()}openModal(e){if(!this.modal)return;this.isEditMode=!!e;const t=document.getElementById("journal-modal-title"),n=document.getElementById("journal-save-text");t&&n&&(this.isEditMode?(t.textContent="Edit Journal Entry",n.textContent="Update Entry"):(t.textContent="New Journal Entry",n.textContent="Save Entry")),this.isEditMode&&e?this.loadEntryData(e):this.resetForm(),this.modal.style.display="flex",this.modal.classList.remove("hidden"),this.modal.offsetWidth,this.modal.classList.add("show"),this.modal.setAttribute("aria-hidden","false"),document.body.style.overflow="hidden",setTimeout(()=>{document.getElementById("journal-title")?.focus()},150)}openModalForMemory(e){if(!this.modal)return;this.isEditMode=!0;const t=document.getElementById("journal-modal-title"),n=document.getElementById("journal-save-text");t&&n&&(t.textContent="Edit Memory",n.textContent="Update Memory"),this.loadMemoryData(e),this.modal.classList.remove("hidden"),this.modal.offsetWidth,this.modal.classList.add("show"),document.body.style.overflow="hidden",setTimeout(()=>{document.getElementById("journal-title")?.focus()},150)}closeModal(){this.modal&&(this.modal.classList.remove("show"),this.modal.setAttribute("aria-hidden","true"),this.modal.classList.add("hidden"),this.modal.style.display="none",document.body.style.overflow="",this.resetForm())}loadEntryData(e){const t=document.querySelector(`[data-journal-id="${e}"]`)?.closest(".journal-entry-card-enhanced");if(!t)return;const n=t.querySelector(".journal-entry-title")?.textContent?.trim()||"",a=t.querySelector(".journal-entry-content")?.textContent?.trim()||"",i=t.querySelector(".journal-entry-mood")?.textContent?.trim()||"ðŸ˜Š",s=t.querySelector(".journal-entry-privacy")?.classList.contains("private")?"private":"shared";document.getElementById("journal-title").value=n,document.getElementById("journal-content").value=a,document.getElementById("journal-mood").value=i,document.getElementById("journal-privacy").value=s;const r=new Event("input");document.getElementById("journal-content")?.dispatchEvent(r)}loadMemoryData(e){const t=document.querySelector(`[data-memory-id="${e}"]`)?.closest(".memory-card");if(!t)return;const n=t.querySelector(".memory-excerpt")?.textContent?.trim()||"",a=t.querySelector(".memory-date")?.textContent?.trim()||"";document.getElementById("journal-title").value=`Memory from ${a}`,document.getElementById("journal-content").value=n,document.getElementById("journal-mood").value="ðŸ¤”",document.getElementById("journal-privacy").value="private";const i=new Event("input");document.getElementById("journal-content")?.dispatchEvent(i)}resetForm(){if(!this.form)return;this.form.reset(),this.isEditMode=!1;const e=document.getElementById("journal-char-count");e&&(e.textContent="0")}async saveEntry(){if(!this.form)return;const e=new FormData(this.form),t={title:e.get("journal-title"),content:e.get("journal-content"),mood:e.get("journal-mood"),privacy:e.get("journal-privacy")};if(!t.title?.trim()||!t.content?.trim()){this.showNotification("Please fill in all required fields","error");return}try{const n=document.getElementById("journal-save"),a=n?.textContent;n&&(n.textContent="Saving..."),await new Promise(i=>setTimeout(i,1e3)),this.isEditMode?this.showNotification("Entry updated successfully!","success"):this.showNotification("Entry saved successfully!","success"),this.closeModal(),n&&a&&(n.textContent=a)}catch{this.showNotification("Failed to save entry. Please try again.","error")}}async saveDraft(){this.showNotification("Draft saved locally","info")}showNotification(e,t){const n=document.createElement("div");n.className=`journal-notification journal-notification-${t}`,n.textContent=e,Object.assign(n.style,{position:"fixed",top:"2rem",right:"2rem",padding:"1rem 1.5rem",borderRadius:"0.75rem",background:t==="success"?"rgba(34, 197, 94, 0.9)":t==="error"?"rgba(239, 68, 68, 0.9)":"rgba(59, 130, 246, 0.9)",color:"white",fontWeight:"500",fontSize:"0.875rem",zIndex:"9999",backdropFilter:"blur(8px)",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.2)",transform:"translateX(100%)",transition:"transform 0.3s ease"}),document.body.appendChild(n),setTimeout(()=>{n.style.transform="translateX(0)"},100),setTimeout(()=>{n.style.transform="translateX(100%)",setTimeout(()=>{document.body.removeChild(n)},300)},3e3)}}typeof document<"u"&&document.addEventListener("DOMContentLoaded",()=>{new l});typeof window<"u"&&new l;
